
ctemplnpc = class("ctemplnpc")

function ctemplnpc:init()
	self.id = 0
	self.resmgr = nil
	self.talk = ""
	self.options = nil
end

function ctemplnpc:config(conf)
	self.nid = assert(conf.nid)
	self.shape = assert(conf.shape)
	self.name = assert(conf.name)
	self.posid = assert(conf.posid)
	self.isclient = assert(conf.isclient)
	-- posid如果被删除了这里会有问题(可以mapid,pos和posid都存),posid坐标变了后再手动计算mapid+pos
	-- 临时处理：只是防止登录失败（自行修改)
	if not data_0401_MapDstPoint[self.posid] or not data_0401_MapDstPoint[tostring(self.posid)] then
		self.posid = 13001003
	end
	local mapid,x,y = scenemgr.getpos(self.posid)
	self.mapid = mapid
	self.pos = { x = x, y = y}
end

function ctemplnpc:setsession(text,options)
	self.text = text
	self.options = options
end

function ctemplnpc:save()
	local data = {}
	data.nid = self.nid
	data.shape= self.shape
	data.name = self.name
	data.isclient = self.isclient
	data.posid = self.posid
	return data
end

function ctemplnpc:load(data)
	if not data or not next(data) then
		return
	end
	self:config(data)
end


function ctemplnpc:look(pid,talk,respond)
	talk = talk or self.talk
	local callback
	local options
	if istrue(respond) then
		options = self.options or self:getoptions(respond)
		callback = function(player,answer)
			local func = self:getrespondfunc(respond)
			if type(func) == "function" then
				func(self,player,answer)
			else
				self:answer(player,answer)
			end
		end
	end
	net.msg.S2C.npcsay(pid,self,talk,options,callback)
end

function ctemplnpc:getrespondfunc(respond)
end

function ctemplnpc:getoptions(respond)
end

function ctemplnpc:answer(player,answer)
end

