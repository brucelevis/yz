local function test(pid)
	local player = playermgr.getplayer(pid)
	local container = player.taskdb:gettaskcontainer("test")
	player.taskdb:clear()
	--寻人任务,服务端执行,自动提交
	net.task.C2S.accepttask(player,{ taskid = 10001,npcid = 1001 })
	local task = player.taskdb:gettask(10001)
	assert(task)
	local npc = container:getnpc_bynid(task,1001)
	net.task.C2S.executetask(player,{ taskid = 10001,npcid = npc.id })
	task = player.taskdb:gettask(10001)
	assert(not task)
	--寻人任务,客户端完成,自动提交
	net.task.C2S.accepttask(player,{taskid = 10001,npcid = 1001 })
	task = player.taskdb:gettask(10001)
	assert(task)
	net.task.C2S.finishtask(player,{taskid = 10001,npcid = 1010 })
	task = player.taskdb:gettask(10001)
	assert(not task)
	--寻物任务,服务端执行,自动提交
	net.task.C2S.accepttask(player,{taskid = 10002,npcid = 1002})
	task = player.taskdb:gettask(10002)
	assert(task)
	player.itemdb:clear()
	player:additembytype(501001,1,nil,"test")
	local itemobj = player.itemdb:getitemsbytype(501001)[1]
	local itemid = itemobj.id
	npc = container:getnpc_bynid(task,1002)
	net.task.C2S.executetask(player,{taskid = 10002,npcid = npc.id,ext = {{itemid=itemid,num=1},}})
	itemobj = player:getitem(itemid)
	assert(not itemobj)
	task = player.taskdb:gettask(10002)
	assert(not task)
	--明雷任务,服务端执行,模拟战斗先失败后胜利,客户端提交
	net.task.C2S.accepttask(player,{taskid = 10003,npcid = 1003})
	task = player.taskdb:gettask(10003)
	assert(task.state)
	npc = container:getnpc_bynid(task,1003)
	net.task.C2S.executetask(player,{taskid = 10003,npcid = npc.id})
	assert(task.state == 1)
	local taskcontainer = player.taskdb:gettaskcontainer_bytaskid(10003)
	taskcontainer:failtask(task)
	assert(task.state == 1)
	net.task.C2S.executetask(player,{taskid = 10003,npcid = npc.id})
	taskcontainer:finishtask(task)
	assert(task.state == 2)
	net.task.C2S.submittask(player,{taskid = 10003,npcid = 1003})
	task = player.taskdb:gettask(10003)
	assert(not task)
	--放弃任务
	net.task.C2S.accepttask(player,{taskid = 10001,npcid = 1001})
	task = player.taskdb:gettask(10001)
	assert(task)
	net.task.C2S.giveuptask(player,{taskid = 10001})
	task = player.taskdb:gettask(10001)
	assert(not task)
end

return test
