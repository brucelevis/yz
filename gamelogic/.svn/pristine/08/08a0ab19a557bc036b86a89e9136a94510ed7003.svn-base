gm = require "gamelogic.gm.init"

local task = {}

function gm.task(args)
	local funcname = args[1]
	local player = playermgr.getplayer(master_pid)
	local func = task[funcname]
	if not func then
		return
	end
	table.remove(args,1)
	func(player,args)
end

--- 指令: task open
--- 用法: task open test <=> 随机接受test类型任务
function task.open(player,args)
	local isok,args = checkargs(args,"string")
	if not isok then
		net.msg.S2C.notify(player.pid,"task open test <=> 随机接受test类型任务")
		return
	end
	local taskkey = args[1]
	net.task.C2S.opentask(player,{ taskkey = taskkey })
end

--- 指令: task add
--- 用法: task add 90000001 <=> 接受90000001任务
function task.add(player,args)
	local isok,args = checkargs(args,"int")
	if not isok then
		net.msg.S2C.notify(player.pid,"task add 90000001 <=> 接受90000001任务")
		return
	end
	local taskid = args[1]
	net.task.C2S.accepttask(player,{ taskid = taskid })
end

--- 指令: task execute
--- 用法: task execute 90000001 <=> 执行任务90000001,触发任务执行行为
function task.execute(player,args)
	local isok,args = checkargs(args,"int")
	if not isok then
		net.msg.S2C.notify(player.pid,"task execute 90000001 <=> 执行90000001任务")
		return
	end
	local taskid = args[1]
	net.task.C2S.executetask(player,{ taskid = taskid })
end

--- 指令: task delete
--- 用法: task delete 90000001 <=> 删除任务90000001
function task.delete(player,args)
	local isok,args = checkargs(args,"int")
	if not isok then
		net.msg.S2C.notify(player.pid,"task delete 90000001 <=> 删除90000001任务")
		return
	end
	local taskid = args[1]
	local taskcontainer = player.taskdb:gettaskcontainer(taskid)
	taskcontainer:deltask(taskid,"gm")
end

