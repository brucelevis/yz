
require "gamelogic.playermgr"

local function test(pid1,pid2)
	local player1 = playermgr.getplayer(pid1)
	local player2 = playermgr.getplayer(pid2)
	player1.frienddb:clear()
	player2.frienddb:clear()
	player1.frienddb:apply_addfriend(pid2)
	local pos = table.find(player2.frienddb.applyerlist,pid1)
	assert(pos)
	player2.frienddb:reject_addfriend(pid1)
	pos = table.find(player2.frienddb.applyerlist,pid1)
	assert(pos==nil)
	player1.frienddb:apply_addfriend(pid2)	
	pos = table.find(player2.frienddb.applyerlist,pid1)
	assert(pos==nil)
	player1.frienddb.thistemp:clear()
	player1.frienddb:apply_addfriend(pid2)
	player2.frienddb:agree_addfriend(pid1)
	pos = table.find(player1.frienddb.frdlist,pid2)
	assert(pos)
	pos = table.find(player2.frienddb.frdlist,pid1)
	assert(pos)
	logger.log("debug","test",format("%s",player1.frienddb.frdlist))
	player1.frienddb:sendmsg(pid2,"hello,world")
	player2.frienddb:req_delfriend(pid1)
	pos = table.find(player1.frienddb.frdlist,pid2)
	assert(pos==nil)
	pos = table.find(player2.frienddb.frdlist,pid1)	
	assert(pos==nil)
	local net = net.friend.C2S
	net.search(player1,{ findplayer = player2.pid, })
	net.search(player1,{ findplayer = player2.name, })
	player1.frienddb:change_recommend()
	logger.log("debug","test",format("%s",player1.frienddb.recommendlist))
	net.addblack(player1,{ pid = player2.pid, })
	net.delblack(player1,{ pid = player2.pid, })
	assert(not table.find(player2.frienddb.frdlist,player1.pid))
end

return test
