
local function test2(pid)
	local player = playermgr.getplayer(pid)
	assert(player.chapterdb:get(10001).pass)
	local net = require "gamelogic.net.chapter"
	net.C2S.getaward(player,{awardid = 1})
	net.C2S.getaward(player,{awardid = 1})
	assert(player.chapterdb:findrecord(1))
	net.C2S.getaward(player,{awardid = 2})
	assert(not player.chapterdb:findrecord(2))
	net.C2S.reviewstory(player,{chapterid = 10001,})
end


local function test(pid)
	local player = playermgr.getplayer(pid)
	player.chapterdb:clear()
	local net = require "gamelogic.net.chapter"
	player.chapterdb:unlockchapter(10001)
	assert(player.chapterdb:get(10001))
	net.C2S.raisewar(player,{ chapterid = 10001 })
	net.C2S.getaward(player,{ awardid = 1})
	assert(not player.chapterdb:findrecord(1))
	timer.timeout("chapter",5,functor(test2,pid))
end

return test
